<!DOCTYPE html>
<html>
<head>
    <title>Progress Update</title>
    <script src="https://cdn.socket.io/4.8.1/socket.io.min.js" integrity="sha384-mkQ3/7FUtcGyoppY6bz/PORYoGqOl7/aSUMn2ymDOJcapfS6PHqxhRTMh1RR0Q6+" crossorigin="anonymous"></script>
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            var socket = io('http://127.0.0.1:5001/', {
                transports: ["websocket"],
                upgrade: false
            });
            socket.on('connect', function () {
                console.log("Connected to Socket.IO server");
                var batchId = 378;
                socket.emit("join", { room: batchId });
            });
            socket.on('join_response', function(data) {
                console.log("Join response:", data);
                document.getElementById("status").innerText = data.msg;
            });
            socket.on('toktak_progress', function(data) {
                console.log("Progress update:", data);
                const progress = document.getElementById("progress");
                const progressData = JSON.parse(data);
                progress.innerHTML = progressData.total_percent + "%";
            });
        });

        document.addEventListener("DOMContentLoaded", function () {
            document.getElementById("start-button").addEventListener("click", function() {
                fetch("http://127.0.0.1:5000/api/v1/user/post-to-links", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                        "Authorization": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJmcmVzaCI6ZmFsc2UsImlhdCI6MTc0MDg4NjYyNCwianRpIjoiOGY2MGFhMTMtODZlMS00YTBmLTg2ZTItZjFmYTE5Zjk4ZTRiIiwidHlwZSI6ImFjY2VzcyIsInN1YiI6IjEiLCJuYmYiOjE3NDA4ODY2MjQsImNzcmYiOiJiZjI1YzM4OS03ODIzLTQ0YjgtOGIyMi1kOTdhNmU2YzA0MWMifQ.jmxlSNrsJUnmq3ZYOZI7wtC9LvMmg29yriitWHxXaeE"
                    },
                    body: JSON.stringify({
                        is_all: 1,
                        link_ids: [],
                        post_id: 1088
                    }),
                })
                .then(response => response.json())
                .then(data => {
                    console.log("API response:", data);
                    // Handle the API response here
                })
                .catch(error => {
                    console.error("API error:", error);
                    // Handle the API error here
                });
            });
        });
    </script>
</head>
<body>
    <button id="start-button">Start</button>
    <h1>Progress Update</h1>
    <p id="status">Not joined any room yet</p>
    <div id="progress">0%</div>
</body>
</html>
